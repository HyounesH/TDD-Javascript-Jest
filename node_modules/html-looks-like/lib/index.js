"use strict";
var jsdom = require("jsdom");
var domWalk = require("domwalk");
var diff_1 = require("./diff");
var report_1 = require("./report");
function trimTextNode(node) {
    if (node.nodeType === 3) {
        var trimmedText = node.textContent.trim();
        if (trimmedText.length === 0) {
            node.parentNode.removeChild(node);
        }
        else {
            node.textContent = trimmedText;
        }
    }
}
function makeDocsAndDiff(actual, expected) {
    var actualDoc = jsdom.jsdom(actual);
    domWalk(actualDoc, trimTextNode);
    var expectedWithWildcards = expected
        .replace(/{{[^}]*}}/g, '<!--$ignored-wildcard-element$-->');
    var expectedDoc = jsdom.jsdom(expectedWithWildcards);
    domWalk(expectedDoc, trimTextNode);
    var diffs = diff_1.makeDiff(actualDoc, expectedDoc);
    return [diffs, actualDoc, expectedDoc];
}
var htmlLooksLike = (function (actual, expected) {
    var _a = makeDocsAndDiff(actual, expected), diffs = _a[0], actualDoc = _a[1], expectedDoc = _a[2];
    if (diffs.length > 0) {
        report_1.reportMismatches(diffs, actualDoc, expectedDoc);
    }
});
htmlLooksLike.bool = function (actual, expected) {
    var diffs = makeDocsAndDiff(actual, expected)[0];
    return diffs.length === 0;
};
module.exports = htmlLooksLike;
//# sourceMappingURL=index.js.map